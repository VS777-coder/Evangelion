<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EVA ANALYZER Rev 4.0.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Squada+One&family=Noto+Sans+JP:wght@700;900&display=swap');
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #1a0505; color: #ef4444; font-family: 'Noto Sans JP', sans-serif; height: 100dvh; width: 100%; margin: 0; padding: 12px; overflow: hidden; display: flex; flex-direction: column; }
        .app-header { text-align: center; margin-bottom: 12px; }
        .main-title { font-family: 'Squada One', cursive; color: #ef4444; font-size: 2.8rem; line-height: 1; }
        .rev-tag { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: #7f1d1d; margin-top: -5px; }
        
        /* 入力フォーム */
        .input-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 12px; }
        .eva-input { background: #2d0a0a; border: 1px solid #7f1d1d; color: #ffffff; padding: 10px; font-size: 14px; border-radius: 6px; outline: none; }
        .full-input { grid-column: span 2; }

        .main-btn { background: #991b1b; border: 2px solid #ef4444; border-radius: 12px; cursor: pointer; height: 60px; width: 100%; display: flex; align-items: center; justify-content: center; }
        .main-btn span { font-weight: 900; font-size: 1.5rem; color: #ffffff; letter-spacing: 4px; }
        
        .panel-frame { border: 2px solid #7f1d1d; background: #2d0a0a; border-radius: 12px; padding: 16px; position: relative; }
        .bar-bg { background-color: #1a0505; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #7f1d1d; margin-top: 4px; }
        .bar-fill { height: 100%; width: 0%; transition: width 1s ease-out; }
        
        .log-container { flex-grow: 1; min-height: 0; margin: 12px 0; border: 2px solid #7f1d1d; background-color: #000000; border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .copy-btn { position: absolute; top: 8px; right: 8px; background: #991b1b; color: #fff; font-size: 9px; padding: 4px 10px; border-radius: 4px; z-index: 20; }
        .log-body { padding: 12px; font-size: 10px; height: 100%; overflow-y: auto; color: #f87171; font-family: 'Share Tech Mono', monospace; padding-top: 35px; }
        
        /* 設定別カラー */
        .c-s1 { color: #f87171; } .bg-s1 { background-color: #f87171; }
        .c-s2 { color: #fca5a5; } .bg-s2 { background-color: #fca5a5; }
        .c-s3 { color: #fecaca; } .bg-s3 { background-color: #fecaca; }
        .c-s4 { color: #fee2e2; } .bg-s4 { background-color: #fee2e2; }
        .c-s5 { color: #ffffff; } .bg-s5 { background-color: #ffffff; }
        .c-s6 { color: #ef4444; } .bg-s6 { background-color: #ef4444; }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="main-title">EVA ANALYZER</div>
        <div class="rev-tag">Revision 4.0.1 - EMERGENCY MODE</div>
    </div>

    <div class="input-grid">
        <input type="number" id="in-g" placeholder="総ゲーム数" class="eva-input full-input" inputmode="numeric">
        <input type="number" id="in-bb" placeholder="BB回数" class="eva-input" inputmode="numeric">
        <input type="number" id="in-rb" placeholder="REG回数" class="eva-input" inputmode="numeric">
        <input type="number" id="in-bel" placeholder="ベル回数" class="eva-input" inputmode="numeric">
        <input type="number" id="in-che" placeholder="チェリー回数" class="eva-input" inputmode="numeric">
        <input type="number" id="in-wsw" placeholder="弱スイカ回数" class="eva-input" inputmode="numeric">
    </div>

    <div class="mb-3"><button id="exec-btn" class="main-btn"><span>解析開始</span></button></div>

    <div class="result-card panel-frame">
        <div class="grid grid-cols-2 gap-x-4">
            <div class="mb-2"><div class="flex justify-between"><span class="c-s1 text-[10px]">設定1</span><span id="p1" class="text-xs">---</span></div><div class="bar-bg"><div id="b1" class="bar-fill bg-s1"></div></div></div>
            <div class="mb-2"><div class="flex justify-between"><span class="c-s2 text-[10px]">設定2</span><span id="p2" class="text-xs">---</span></div><div class="bar-bg"><div id="b2" class="bar-fill bg-s2"></div></div></div>
            <div class="mb-2"><div class="flex justify-between"><span class="c-s3 text-[10px]">設定3</span><span id="p3" class="text-xs">---</span></div><div class="bar-bg"><div id="b3" class="bar-fill bg-s3"></div></div></div>
            <div class="mb-2"><div class="flex justify-between"><span class="c-s4 text-[10px]">設定4</span><span id="p4" class="text-xs">---</span></div><div class="bar-bg"><div id="b4" class="bar-fill bg-s4"></div></div></div>
            <div class="mb-2"><div class="flex justify-between"><span class="c-s5 text-[10px]">設定5</span><span id="p5" class="text-xs">---</span></div><div class="bar-bg"><div id="b5" class="bar-fill bg-s5"></div></div></div>
            <div class="mb-2"><div class="flex justify-between"><span class="c-s6 text-[10px]">設定6</span><span id="p6" class="text-xs">---</span></div><div class="bar-bg"><div id="b6" class="bar-fill bg-s6"></div></div></div>
        </div>
    </div>

    <div class="log-container"><button id="copy-log" class="copy-btn">COPY</button><div id="log-display" class="log-body">SYSTEM ONLINE. READY.</div></div>

<script>
const EVA_CONFIG = [
    { id: "bb", name: "BB", probs: {1: 300.6, 2: 290.0, 3: 281.3, 4: 266.4, 5: 254.0, 6: 240.9} },
    { id: "rb", name: "RB", probs: {1: 569.9, 2: 546.1, 3: 508.0, 4: 474.9, 5: 442.8, 6: 404.5} },
    { id: "bel", name: "ベル", probs: {1: 8.0, 2: 7.88, 3: 7.76, 4: 7.64, 5: 7.52, 6: 7.4} },
    { id: "che", name: "チェリー", probs: {1: 60.0, 2: 57.4, 3: 54.8, 4: 52.2, 5: 49.6, 6: 47.0} },
    { id: "wsw", name: "弱スイカ", probs: {1: 79.0, 2: 76.4, 3: 73.8, 4: 71.2, 5: 68.6, 6: 66.0} }
];

const logDisplay = document.getElementById('log-display');
const addLog = (m, c="text-red-900") => {
    const e = document.createElement('div');
    e.className = c;
    e.innerHTML = m;
    logDisplay.appendChild(e);
};

// 解析実行処理
document.getElementById('exec-btn').addEventListener('click', () => {
    const totalG = parseInt(document.getElementById('in-g').value) || 0;
    if (totalG < 10) return alert("総ゲーム数を入力してください");

    logDisplay.innerHTML = "";
    addLog("--- MAGI ANALYSIS START ---", "text-red-400 font-bold");

    const inputs = {
        bb: parseInt(document.getElementById('in-bb').value) || 0,
        rb: parseInt(document.getElementById('in-rb').value) || 0,
        bel: parseInt(document.getElementById('in-bel').value) || 0,
        che: parseInt(document.getElementById('in-che').value) || 0,
        wsw: parseInt(document.getElementById('in-wsw').value) || 0
    };

    let totalLLs = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
    
    // 計算ロジック
    EVA_CONFIG.forEach(def => {
        const k = inputs[def.id];
        const n = totalG;
        addLog(`${def.name}: ${k}回 (1/${(n/k||0).toFixed(1)})`, "text-red-300");

        [1,2,3,4,5,6].forEach(s => {
            const p = 1 / def.probs[s];
            totalLLs[s] += (k * Math.log(p) + (n - k) * Math.log(1 - p));
        });
    });

    // 確率変換
    const maxLL = Math.max(...Object.values(totalLLs));
    let sumExp = 0;
    const exps = {};
    [1,2,3,4,5,6].forEach(s => {
        exps[s] = Math.exp(totalLLs[s] - maxLL);
        sumExp += exps[s];
    });

    [1,2,3,4,5,6].forEach(s => {
        const prob = (exps[s] / sumExp) * 100;
        document.getElementById(`p${s}`).innerText = prob.toFixed(1) + "%";
        document.getElementById(`b${s}`).style.width = prob + "%";
    });

    addLog("--- ANALYSIS COMPLETE ---", "text-red-400 font-bold");
});

// コピペ用
document.getElementById('copy-log').onclick = () => {
    const area = document.createElement('textarea');
    area.value = logDisplay.innerText;
    document.body.appendChild(area);
    area.select();
    document.execCommand('copy');
    document.body.removeChild(area);
    alert("LOG COPIED.");
};
</script>
</body>
</html>