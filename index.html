<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EVA Mobile Rev 4.0.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Squada+One&family=Noto+Sans+JP:wght@700;900&display=swap');
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #1a0505; color: #ef4444; font-family: 'Noto Sans JP', sans-serif; height: 100dvh; width: 100%; margin: 0; padding: 8px; overflow: hidden; display: flex; flex-direction: column; }
        
        .app-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; border-bottom: 1px solid #7f1d1d; }
        .main-title { font-family: 'Squada One', cursive; color: #ef4444; font-size: 1.5rem; }
        .rev-tag { font-family: 'Share Tech Mono', monospace; font-size: 8px; color: #7f1d1d; }
        
        /* 入力フォームの超圧縮 */
        .input-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 6px; }
        .eva-input { background: #2d0a0a; border: 1px solid #7f1d1d; color: #ffffff; padding: 4px 6px; font-size: 12px; border-radius: 4px; outline: none; text-align: center; }
        .full-input { grid-column: span 3; border-color: #ef4444; font-weight: bold; }
        .input-label { font-size: 8px; color: #7f1d1d; text-align: center; margin-bottom: 1px; }

        .main-btn { background: #991b1b; border: 1px solid #ef4444; border-radius: 6px; cursor: pointer; height: 36px; width: 100%; display: flex; align-items: center; justify-content: center; margin-bottom: 6px; }
        .main-btn span { font-weight: 900; font-size: 1rem; color: #ffffff; letter-spacing: 2px; }
        
        .panel-frame { border: 1px solid #7f1d1d; background: #2d0a0a; border-radius: 6px; padding: 6px; }
        .bar-bg { background-color: #1a0505; height: 6px; border-radius: 3px; overflow: hidden; border: 1px solid #7f1d1d; margin-top: 2px; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.8s ease-out; }
        
        .log-container { flex-grow: 1; min-height: 0; margin: 6px 0; border: 1px solid #7f1d1d; background-color: #000000; border-radius: 6px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .copy-btn { position: absolute; top: 4px; right: 4px; background: #991b1b; color: #fff; font-size: 7px; padding: 2px 6px; border-radius: 3px; z-index: 20; }
        .log-body { padding: 6px; font-size: 9px; height: 100%; overflow-y: auto; color: #f87171; font-family: 'Share Tech Mono', monospace; padding-top: 20px; }
        
        /* 設定別カラー */
        .c-s1 { color: #f87171; } .bg-s1 { background-color: #f87171; }
        .c-s2 { color: #fca5a5; } .bg-s2 { background-color: #fca5a5; }
        .c-s3 { color: #fecaca; } .bg-s3 { background-color: #fecaca; }
        .c-s4 { color: #fee2e2; } .bg-s4 { background-color: #fee2e2; }
        .c-s5 { color: #ffffff; } .bg-s5 { background-color: #ffffff; }
        .c-s6 { color: #ef4444; } .bg-s6 { background-color: #ef4444; }
    </style>
</head>
<body>
    <div class="app-header">
        <div class="main-title">EVA ANALYZER</div>
        <div class="rev-tag">Rev 4.0.2</div>
    </div>

    <div class="input-grid">
        <div class="full-input"><div class="input-label">TOTAL GAMES</div><input type="number" id="in-g" class="eva-input w-full" inputmode="numeric"></div>
        <div><div class="input-label">BB</div><input type="number" id="in-bb" class="eva-input w-full" inputmode="numeric"></div>
        <div><div class="input-label">RB</div><input type="number" id="in-rb" class="eva-input w-full" inputmode="numeric"></div>
        <div><div class="input-label">BEL</div><input type="number" id="in-bel" class="eva-input w-full" inputmode="numeric"></div>
        <div><div class="input-label">CHE</div><input type="number" id="in-che" class="eva-input w-full" inputmode="numeric"></div>
        <div><div class="input-label">WSW</div><input type="number" id="in-wsw" class="eva-input w-full" inputmode="numeric"></div>
    </div>

    <button id="exec-btn" class="main-btn"><span>ANALYZE</span></button>

    <div class="result-card panel-frame">
        <div class="grid grid-cols-3 gap-x-2">
            <div class="mb-1"><div class="flex justify-between"><span class="c-s1 text-[8px]">S1</span><span id="p1" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b1" class="bar-fill bg-s1"></div></div></div>
            <div class="mb-1"><div class="flex justify-between"><span class="c-s2 text-[8px]">S2</span><span id="p2" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b2" class="bar-fill bg-s2"></div></div></div>
            <div class="mb-1"><div class="flex justify-between"><span class="c-s3 text-[8px]">S3</span><span id="p3" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b3" class="bar-fill bg-s3"></div></div></div>
            <div class="mb-1"><div class="flex justify-between"><span class="c-s4 text-[8px]">S4</span><span id="p4" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b4" class="bar-fill bg-s4"></div></div></div>
            <div class="mb-1"><div class="flex justify-between"><span class="c-s5 text-[8px]">S5</span><span id="p5" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b5" class="bar-fill bg-s5"></div></div></div>
            <div class="mb-1"><div class="flex justify-between"><span class="c-s6 text-[8px]">S6</span><span id="p6" class="text-[9px]">--</span></div><div class="bar-bg"><div id="b6" class="bar-fill bg-s6"></div></div></div>
        </div>
    </div>

    <div class="log-container"><button id="copy-log" class="copy-btn">COPY</button><div id="log-display" class="log-body">NERV MAGI: ONLINE</div></div>

<script>
const EVA_CONFIG = [
    { id: "bb", name: "BB", probs: {1: 300.6, 2: 290.0, 3: 281.3, 4: 266.4, 5: 254.0, 6: 240.9} },
    { id: "rb", name: "RB", probs: {1: 569.9, 2: 546.1, 3: 508.0, 4: 474.9, 5: 442.8, 6: 404.5} },
    { id: "bel", name: "ベル", probs: {1: 8.0, 2: 7.88, 3: 7.76, 4: 7.64, 5: 7.52, 6: 7.4} },
    { id: "che", name: "チェリー", probs: {1: 60.0, 2: 57.4, 3: 54.8, 4: 52.2, 5: 49.6, 6: 47.0} },
    { id: "wsw", name: "弱スイカ", probs: {1: 79.0, 2: 76.4, 3: 73.8, 4: 71.2, 5: 68.6, 6: 66.0} }
];

const logDisplay = document.getElementById('log-display');
const addLog = (m, c="text-red-900") => {
    const e = document.createElement('div'); e.className = c; e.innerHTML = m;
    logDisplay.appendChild(e);
};

document.getElementById('exec-btn').addEventListener('click', () => {
    const n = parseInt(document.getElementById('in-g').value) || 0;
    if (n < 10) return;
    logDisplay.innerHTML = "";
    addLog("MAGI SYS START", "text-red-400 font-bold");

    const inputs = {
        bb: parseInt(document.getElementById('in-bb').value) || 0,
        rb: parseInt(document.getElementById('in-rb').value) || 0,
        bel: parseInt(document.getElementById('in-bel').value) || 0,
        che: parseInt(document.getElementById('in-che').value) || 0,
        wsw: parseInt(document.getElementById('in-wsw').value) || 0
    };

    let lls = {1:0, 2:0, 3:0, 4:0, 5:0, 6:0};
    EVA_CONFIG.forEach(def => {
        const k = inputs[def.id];
        addLog(`${def.name}:${k} (1/${(n/k||0).toFixed(1)})`);
        [1,2,3,4,5,6].forEach(s => {
            const p = 1 / def.probs[s];
            lls[s] += (k * Math.log(p) + (n - k) * Math.log(1 - p));
        });
    });

    const max = Math.max(...Object.values(lls));
    let sum = 0; const ex = {};
    [1,2,3,4,5,6].forEach(s => { ex[s] = Math.exp(lls[s] - max); sum += ex[s]; });
    [1,2,3,4,5,6].forEach(s => {
        const p = (ex[s] / sum) * 100;
        document.getElementById(`p${s}`).innerText = p.toFixed(1) + "%";
        document.getElementById(`b${s}`).style.width = p + "%";
    });
});

document.getElementById('copy-log').onclick = () => {
    const a = document.createElement('textarea'); a.value = logDisplay.innerText;
    document.body.appendChild(a); a.select(); document.execCommand('copy');
    document.body.removeChild(a); alert("COPIED");
};
</script>
</body>
</html>